services:
  # Web Service - Serves both Google and Meta feeds
  - type: web
    name: racoon-lab-feed-server-multiplatform
    env: python
    region: frankfurt  # EU region
    plan: free  # Free tier (or 'starter' for $7/mo)
    buildCommand: "pip install -r requirements.txt"
    startCommand: "gunicorn app_multiplatform:app"
    envVars:
      - key: SHOPIFY_SHOP_URL
        sync: false  # Set manually in Render dashboard
      - key: SHOPIFY_ACCESS_TOKEN
        sync: false  # Set manually in Render dashboard
      - key: SHOP_BASE_URL
        value: https://racoon-lab.it
      - key: PYTHON_VERSION
        value: 3.11.0
    healthCheckPath: /health
    
  # Cron Job - Generates all enabled feeds daily
  - type: cron
    name: racoon-lab-feed-generator-multiplatform
    env: python
    region: frankfurt
    plan: free
    schedule: "0 6 * * *"  # Daily at 6:00 AM UTC (7:00 AM CET)
    buildCommand: "pip install -r requirements.txt"
    startCommand: "python orchestrator.py"  # Generates all enabled feeds
    envVars:
      - key: SHOPIFY_SHOP_URL
        sync: false
      - key: SHOPIFY_ACCESS_TOKEN
        sync: false
      - key: SHOP_BASE_URL
        value: https://racoon-lab.it
